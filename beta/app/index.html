<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>QHub - Dein pers√∂nlicher Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet">
    
    <link rel="icon" type="image/svg+xml" href="https://quixoticode.github.io/data/qhub/favicon.svg" />
    <link rel="manifest" href="data:application/manifest+json;base64,ew0KICAgICJuYW1lIjogIlFIdWIgVjIuMyIsICJzaG9ydF9uYW1lIjogIlFIdWIiLCAiZGVzY3JpcHRpb24iOiAiRGVpbiBwZXJzw7ZubGljaGVyIEh1YiBtaXQgUHJlbWl1bS1GdW5rdGlvbmVuIiwgImljb25zIjogW3sic3JjIjogImh0dHBzOi8vcXVpeG90aWNvZGUuZ2l0aHViLmlvL2RhdGEvcWh1Yi9hbmRyb2lkLWNocm9tZS0xOTJ4MTkyLnBuZyIsICJzaXplcyI6ICIxOTJ4MTkyIiwgInR5cGUiOiAiaW1hZ2UvcG5nIn0sIHsic3JjIjogImh0dHBzOi8vcXVpeG90aWNvZGUuZ2l0aHViLmlvL2RhdGEvcWh1Yi9hbmRyb2lkLWNocm9tZS01MTJ4NTEyLnBuZyIsICJzaXplcyI6ICI1MTJ4NTEyIiwgInR5cGUiOiAiaW1hZ2UvcG5nIn1dLA0KICAgICJzdGFydF91cmwiOiAiLi8iLCAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwgImJhY2tncm91bmRfY29sb3IiOiAiI2YxZjVmOSIsICJ0aGVtZV9jb2xvciI6ICIjNGY0NmU1Ig0KfQ==">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="QHub">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" id="themeColorMeta" content="#4f46e5">

    <style>
        :root {
            --font-family-sans: 'Inter', sans-serif;
            --q-primary: #4f46e5; --q-primary-hover: #4338ca; --q-primary-text: #ffffff;
            --q-background: #f1f5f9; --q-surface: #ffffff;
            --q-on-surface: #1e293b; --q-on-surface-variant: #64748b; --q-outline: #cbd5e1;
            --q-highlight: #e0e7ff; --q-highlight-text: #3730a3; --q-danger: #dc2626;
            --q-premium: #f59e0b; --q-on-premium: #ffffff;
            --q-beta: #10b981; --q-on-beta: #ffffff;
            --q-owner: #7c3aed; --q-on-owner: #ffffff;
            --radius-md: 0.5rem; --radius-lg: 0.75rem; --radius-full: 9999px;
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --activity-bar-width: 60px; --sidebar-width: 280px;
            --header-height: 64px; --transition-speed: 0.3s;
        }
        [data-theme="dark"] { --q-primary: #6366f1; --q-primary-hover: #4f46e5; --q-background: #0f172a; --q-surface: #1e293b; --q-on-surface: #e2e8f0; --q-on-surface-variant: #94a3b8; --q-outline: #334155; --q-highlight: #312e81; --q-highlight-text: #c7d2fe; --q-premium: #fcd34d; --q-on-premium: #1e293b; }
        body { font-family: var(--font-family-sans); background-color: var(--q-background); color: var(--q-on-surface); overflow: hidden; }
        .q-app-container { display: flex; height: 100vh; }
        .q-activity-bar { width: var(--activity-bar-width); flex-shrink: 0; background-color: var(--q-surface); border-right: 1px solid var(--q-outline); display: flex; flex-direction: column; align-items: center; padding: 1rem 0; padding-bottom: calc(1rem + env(safe-area-inset-bottom)); gap: 0.5rem; z-index: 1100; }
        .activity-btn { position: relative; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-md); color: var(--q-on-surface-variant); cursor: pointer; transition: all 0.2s; }
        .activity-btn:hover { background-color: var(--q-highlight); color: var(--q-highlight-text); }
        .activity-btn.active { background-color: var(--q-primary); color: var(--q-primary-text); }
        .q-sidebar { width: var(--sidebar-width); flex-shrink: 0; background-color: var(--q-surface); border-right: 1px solid var(--q-outline); padding: 1.5rem; display: flex; flex-direction: column; z-index: 1000; transition: transform var(--transition-speed) ease; }
        .q-main-content { flex-grow: 1; display: flex; flex-direction: column; height: 100vh; }
        .q-header { height: var(--header-height); flex-shrink: 0; background-color: var(--q-surface); border-bottom: 1px solid var(--q-outline); display: flex; align-items: center; justify-content: space-between; padding: 0 2rem; z-index: 900; }
        .q-content-area { flex-grow: 1; overflow-y: auto; padding: 2rem; }
        .webapp-container, .webapp-container iframe { width: 100%; height: 100%; border: none; background-color: #fff; border-radius: var(--radius-lg); }
        .q-card { background-color: var(--q-surface); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-md); border: 1px solid var(--q-outline); }
        .q-modal-backdrop { position: fixed; inset: 0; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 5000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; padding: 1rem; }
        .q-modal-backdrop.visible { display: flex; opacity: 1; }
        .q-modal-content { background-color: var(--q-surface); padding: 2rem; border-radius: var(--radius-lg); max-width: 500px; width: 100%; }
        @media (max-width: 768px) {
            .q-modal-backdrop.visible { overflow-y: auto; align-items: flex-start; }
            .q-modal-content { width: 95%; margin-top: 5vh; max-height: 90vh; overflow-y: auto; padding: 1.5rem; }
            .q-sidebar { position: fixed; left: var(--activity-bar-width); height: 100%; transform: translateX(-100%); } 
            .q-sidebar.open { transform: translateX(0); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); } 
            .q-header { padding: 0 1rem; }
            .q-content-area { padding: 1rem; }
        }
        .role-badge { display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.1rem 0.5rem; border-radius: var(--radius-full); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
        .role-badge.premium { background-color: var(--q-premium); color: var(--q-on-premium); }
        .role-badge.beta { background-color: var(--q-beta); color: var(--q-on-beta); }
        .role-badge.owner { background-color: var(--q-owner); color: var(--q-on-owner); }
        .timeline { border-left: 2px solid var(--q-outline); margin-left: 1rem; padding-left: 1.5rem; }
        .timeline-item { position: relative; padding-bottom: 2rem; } .timeline-item:last-child { padding-bottom: 0; }
        .timeline-icon { position: absolute; left: -2.25rem; top: 0; width: 2rem; height: 2rem; background-color: var(--q-highlight); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .timeline-icon .material-icons { color: var(--q-highlight-text); font-size: 1.25rem; }
        .progress-bar-bg { background-color: var(--q-highlight); border-radius: var(--radius-full); }
        .progress-bar-fill { background-color: var(--q-primary); transition: width 0.5s ease; }
    </style>
</head>
<body>

    <div class="q-app-container">
        <!-- Activity Bar: Icons for main navigation -->
        <div class="q-activity-bar" id="activityBar">
            <button class="activity-btn" data-view="dashboard" title="Dashboard"><span class="material-icons">dashboard</span></button>
            <button class="activity-btn" data-view="web" title="Web"><span class="material-icons">public</span></button>
            <button class="activity-btn" data-view="qcode" title="QCode Lernplattform"><span class="material-icons">school</span></button>
            <button class="activity-btn" data-view="qsounds" title="QSounds"><span class="material-icons">graphic_eq</span></button>
            <button class="activity-btn hidden" data-view="qpets" title="QPet's"><span class="material-icons">pets</span></button>
            <div class="flex-grow"></div>
            <button class="activity-btn hidden" id="betaBtn" title="Beta Apps"><span class="material-icons">science</span></button>
            <button class="activity-btn" data-view="contact" title="Kontakt"><span class="material-icons">contact_support</span></button>
            <button class="activity-btn" data-view="status" title="Statuspage"><span class="material-icons">error</span></button>
            <button class="activity-btn" id="settingsBtn" title="Einstellungen"><span class="material-icons">settings</span></button>
        </div>
        
        <aside class="q-sidebar hidden" id="qHubSidebar"></aside>

        <div class="q-main-content">
            <header class="q-header">
                <button id="mobileMenuBtn" class="md:hidden p-2"><span class="material-icons">menu</span></button>
                <div id="headerTitle" class="text-xl font-bold"></div>
            </header>
            <main class="q-content-area" id="mainContentArea"></main>
        </div>
    </div>

    <div id="settingsModal" class="q-modal-backdrop"></div>
    <div id="toastContainer" class="fixed bottom-5 right-5 z-[6000] space-y-2"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const APP_PREFIX = 'qhub_v2.5.0_';
        const SETTINGS_KEY = APP_PREFIX + 'settings';
        const APP_VERSION = "2.5.0";

        // --- TRANSLATION DATA ---
        
        // Static UI translations
        const translations = {
            de: {
                viewTitles: { dashboard: "Dashboard", web: "Web", qcode: "QCode Lernplattform", qsounds: "QSounds", qpets: "QPet's", contact: "Kontakt", status: "Statuspage", settings: "Einstellungen", beta: "Beta Apps" },
                sidebar: { sections: "Sektionen" },
                dashboardModules: { announcements: { title: "Ank√ºndigungen", none: "Keine Ank√ºndigungen vorhanden." }, roadmap: { title: "Roadmap", none: "Keine Roadmap-Eintr√§ge vorhanden.", progress: "Fortschritt" }, changelog: { title: "Changelog", none: "Kein Changelog vorhanden.", version: "Version" } },
                statusPage: { cannot_embed_title: "Die Status-Seite kann nicht eingebettet werden.", cannot_embed_desc: "Du kannst die Seite stattdessen direkt aufrufen.", open_button: "Status-Seite √∂ffnen" },
                settingsModal: { title: "Einstellungen", account: "Account", loggedInAs: "Angemeldet als", logout: "Abmelden", login: "Anmelden", username: "Benutzername", password: "Passwort / Einmal-Code", theme: "Theme", language: "Sprache" },
                toasts: { welcome: "Willkommen", logout_success: "Erfolgreich abgemeldet.", login_error: "Ung√ºltige Anmeldedaten.", user_not_found: "Benutzerdaten konnten nicht geladen werden", enter_username: "Bitte gib einen Benutzernamen ein.", enter_password: "Bitte gib ein Passwort oder einen Code ein." },
                login: { checking: "Pr√ºfe..." }
            },
            en: {
                viewTitles: { dashboard: "Dashboard", web: "Web", qcode: "QCode Learning Platform", qsounds: "QSounds", qpets: "QPet's", contact: "Contact", status: "Status Page", settings: "Settings", beta: "Beta Apps" },
                sidebar: { sections: "Sections" },
                dashboardModules: { announcements: { title: "Announcements", none: "No announcements available." }, roadmap: { title: "Roadmap", none: "No roadmap items available.", progress: "Progress" }, changelog: { title: "Changelog", none: "No changelog available.", version: "Version" } },
                statusPage: { cannot_embed_title: "The status page cannot be embedded.", cannot_embed_desc: "You can visit the page directly instead.", open_button: "Open Status Page" },
                settingsModal: { title: "Settings", account: "Account", loggedInAs: "Logged in as", logout: "Log out", login: "Log in", username: "Username", password: "Password / One-Time Code", theme: "Theme", language: "Language" },
                toasts: { welcome: "Welcome", logout_success: "Successfully logged out.", login_error: "Invalid credentials.", user_not_found: "Could not load user data", enter_username: "Please enter a username.", enter_password: "Please enter a password or code." },
                login: { checking: "Checking..." }
            },
            fi: {
                viewTitles: { dashboard: "Kojelauta", web: "Verkko", qcode: "QCode Oppimisalusta", qsounds: "QSounds", qpets: "QPet's", contact: "Ota yhteytt√§", status: "Tilasivu", settings: "Asetukset", beta: "Beetasovellukset" },
                sidebar: { sections: "Osastot" },
                dashboardModules: { announcements: { title: "Ilmoitukset", none: "Ei ilmoituksia saatavilla." }, roadmap: { title: "Tiekartta", none: "Tiekarttaa ei ole saatavilla.", progress: "Edistyminen" }, changelog: { title: "Muutosloki", none: "Muutoslokia ei ole saatavilla.", version: "Versio" } },
                statusPage: { cannot_embed_title: "Tilasivua ei voi upottaa.", cannot_embed_desc: "Voit sen sijaan vierailla sivulla suoraan.", open_button: "Avaa Tilasivu" },
                settingsModal: { title: "Asetukset", account: "Tili", loggedInAs: "Kirjautuneena nimell√§", logout: "Kirjaudu ulos", login: "Kirjaudu sis√§√§n", username: "K√§ytt√§j√§tunnus", password: "Salasana / Kertak√§ytt√∂koodi", theme: "Teema", language: "Kieli" },
                toasts: { welcome: "Tervetuloa", logout_success: "Uloskirjautuminen onnistui.", login_error: "Virheelliset tunnisteet.", user_not_found: "K√§ytt√§j√§tietoja ei voitu ladata", enter_username: "Anna k√§ytt√§j√§tunnus.", enter_password: "Anna salasana tai koodi." },
                login: { checking: "Tarkistetaan..." }
            },
            ja: {
                viewTitles: { dashboard: "„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ", web: "„Ç¶„Çß„Éñ", qcode: "QCodeÂ≠¶Áøí„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†", qsounds: "QSounds", qpets: "QPet's", contact: "„ÅäÂïè„ÅÑÂêà„Çè„Åõ", status: "„Çπ„ÉÜ„Éº„Çø„Çπ„Éö„Éº„Ç∏", settings: "Ë®≠ÂÆö", beta: "„Éô„Éº„Çø„Ç¢„Éó„É™" },
                sidebar: { sections: "„Çª„ÇØ„Ç∑„Éß„É≥" },
                dashboardModules: { announcements: { title: "„ÅäÁü•„Çâ„Åõ", none: "„ÅäÁü•„Çâ„Åõ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ" }, roadmap: { title: "„É≠„Éº„Éâ„Éû„ÉÉ„Éó", none: "„É≠„Éº„Éâ„Éû„ÉÉ„ÉóÈ†ÖÁõÆ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ", progress: "ÈÄ≤Êçó" }, changelog: { title: "Â§âÊõ¥Â±•Ê≠¥", none: "Â§âÊõ¥Â±•Ê≠¥„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ", version: "„Éê„Éº„Ç∏„Éß„É≥" } },
                statusPage: { cannot_embed_title: "„Çπ„ÉÜ„Éº„Çø„Çπ„Éö„Éº„Ç∏„ÅØÂüã„ÇÅËæº„ÇÅ„Åæ„Åõ„Çì„ÄÇ", cannot_embed_desc: "‰ª£„Çè„Çä„Å´Áõ¥Êé•„Éö„Éº„Ç∏„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åô„ÄÇ", open_button: "„Çπ„ÉÜ„Éº„Çø„Çπ„Éö„Éº„Ç∏„ÇíÈñã„Åè" },
                settingsModal: { title: "Ë®≠ÂÆö", account: "„Ç¢„Ç´„Ç¶„É≥„Éà", loggedInAs: "„Åß„É≠„Ç∞„Ç§„É≥‰∏≠", logout: "„É≠„Ç∞„Ç¢„Ç¶„Éà", login: "„É≠„Ç∞„Ç§„É≥", username: "„É¶„Éº„Ç∂„ÉºÂêç", password: "„Éë„Çπ„ÉØ„Éº„Éâ / „ÉØ„É≥„Çø„Ç§„É†„Ç≥„Éº„Éâ", theme: "„ÉÜ„Éº„Éû", language: "Ë®ÄË™û" },
                toasts: { welcome: "„Çà„ÅÜ„Åì„Åù", logout_success: "Ê≠£Â∏∏„Å´„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇ", login_error: "ÁÑ°Âäπ„Å™Ë™çË®ºÊÉÖÂ†±„Åß„Åô„ÄÇ", user_not_found: "„É¶„Éº„Ç∂„Éº„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì„Åß„Åó„Åü", enter_username: "„É¶„Éº„Ç∂„ÉºÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", enter_password: "„Éë„Çπ„ÉØ„Éº„Éâ„Åæ„Åü„ÅØ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ" },
                login: { checking: "Á¢∫Ë™ç‰∏≠..." }
            },
            fr: {
                viewTitles: { dashboard: "Tableau de bord", web: "Web", qcode: "Plateforme d'apprentissage QCode", qsounds: "QSounds", qpets: "QPet's", contact: "Contact", status: "Page de statut", settings: "Param√®tres", beta: "Applications B√™ta" },
                sidebar: { sections: "Sections" },
                dashboardModules: { announcements: { title: "Annonces", none: "Aucune annonce disponible." }, roadmap: { title: "Feuille de route", none: "Aucun √©l√©ment de feuille de route disponible.", progress: "Progression" }, changelog: { title: "Journal des modifications", none: "Aucun journal des modifications disponible.", version: "Version" } },
                statusPage: { cannot_embed_title: "La page de statut ne peut pas √™tre int√©gr√©e.", cannot_embed_desc: "Vous pouvez visiter la page directement √† la place.", open_button: "Ouvrir la page de statut" },
                settingsModal: { title: "Param√®tres", account: "Compte", loggedInAs: "Connect√© en tant que", logout: "Se d√©connecter", login: "Se connecter", username: "Nom d'utilisateur", password: "Mot de passe / Code unique", theme: "Th√®me", language: "Langue" },
                toasts: { welcome: "Bienvenue", logout_success: "D√©connexion r√©ussie.", login_error: "Identifiants invalides.", user_not_found: "Impossible de charger les donn√©es utilisateur", enter_username: "Veuillez entrer un nom d'utilisateur.", enter_password: "Veuillez entrer un mot de passe ou un code." },
                login: { checking: "V√©rification..." }
            }
        };

        // Dynamic, translatable content for dashboard modules
        const dynamicContent = {
            announcements: [
                { 
                    id: "news-1", date: "2025-07-01", premium: false,
                    translations: {
                        de: { title: "Willkommen zu QHub 2.5!", content: "Die App ist jetzt vollst√§ndig mehrsprachig! √Ñndere die Sprache in den Einstellungen, um auch die Inhalte √ºbersetzt zu sehen." },
                        en: { title: "Welcome to QHub 2.5!", content: "The app is now fully multilingual! Change the language in the settings to see the content translated as well." },
                        fi: { title: "Tervetuloa QHub 2.5:een!", content: "Sovellus on nyt t√§ysin monikielinen! Vaihda kielt√§ asetuksista n√§hd√§ksesi my√∂s sis√§ll√∂n k√§√§nnettyn√§." },
                        ja: { title: "QHub 2.5„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ", content: "„Ç¢„Éó„É™„ÅØÂÆåÂÖ®„Å´Â§öË®ÄË™ûÂØæÂøú„Å´„Å™„Çä„Åæ„Åó„ÅüÔºÅË®≠ÂÆö„ÅßË®ÄË™û„ÇíÂ§âÊõ¥„Åó„Å¶„ÄÅ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇÇÁøªË®≥„Åó„Å¶„ÅîË¶ß„Åè„Å†„Åï„ÅÑ„ÄÇ" },
                        fr: { title: "Bienvenue sur QHub 2.5 !", content: "L'application est maintenant enti√®rement multilingue ! Changez la langue dans les param√®tres pour voir √©galement le contenu traduit." }
                    }
                },
                { 
                    id: "news-2", date: "2025-06-23", premium: true,
                    translations: {
                        de: { title: "Premium-Special: QPet's", content: "Ziehe dein eigenes virtuelles Haustier auf! Nur f√ºr Premium-Nutzer." },
                        en: { title: "Premium Special: QPet's", content: "Raise your own virtual pet! Only for Premium users." },
                        fi: { title: "Premium-erikoisuus: QPet's", content: "Kasvata oma virtuaalinen lemmikkisi! Vain Premium-k√§ytt√§jille." },
                        ja: { title: "„Éó„É¨„Éü„Ç¢„É†„Çπ„Éö„Ç∑„É£„É´ÔºöQPet's", content: "Ëá™ÂàÜ„Å†„Åë„ÅÆ„Éê„Éº„ÉÅ„É£„É´„Éö„ÉÉ„Éà„ÇíËÇ≤„Å¶„Çà„ÅÜÔºÅ„Éó„É¨„Éü„Ç¢„É†„É¶„Éº„Ç∂„ÉºÈôêÂÆö„ÄÇ" },
                        fr: { title: "Sp√©cial Premium : QPet's", content: "√âlevez votre propre animal de compagnie virtuel ! Uniquement pour les utilisateurs Premium." }
                    }
                },
            ],
            roadmap: [
                { 
                    id: "rm-1", status: 'in-progress', progress: 20,
                    translations: {
                        de: { title: 'Theme Store', description: 'F√ºr Premium' },
                        en: { title: 'v2.6: Admin Update', description: 'Improvements to the user system and roles.' },
                        fi: { title: 'v2.6: J√§rjestelm√§nvalvojan p√§ivitys', description: 'Parannuksia k√§ytt√§j√§j√§rjestelm√§√§n ja rooleihin.' },
                        ja: { title: 'v2.6: ÁÆ°ÁêÜËÄÖ„Ç¢„ÉÉ„Éó„Éá„Éº„Éà', description: '„É¶„Éº„Ç∂„Éº„Ç∑„Çπ„ÉÜ„É†„Å®ÂΩπÂâ≤„ÅÆÊîπÂñÑ„ÄÇ' },
                        fr: { title: 'v2.6: Mise √† jour Admin', description: 'Am√©liorations du syst√®me utilisateur et des r√¥les.' }
                    }
                },
                { 
                    id: "rm-2", status: 'planned',
                    translations: {
                        de: { title: 'Integrations', description: '???' },
                        en: { title: 'v2.7: Calendar Widget', description: 'A simple calendar for an overview of appointments directly on the dashboard.' },
                        fi: { title: 'v2.7: Kalenteri-widget', description: 'Yksinkertainen kalenteri tapaamisten yleiskatsaukseen suoraan kojelaudalla.' },
                        ja: { title: 'v2.7: „Ç´„É¨„É≥„ÉÄ„Éº„Ç¶„Ç£„Ç∏„Çß„ÉÉ„Éà', description: '„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅßÁõ¥Êé•‰∫àÂÆö„ÇíÊ¶ÇË¶≥„Åß„Åç„Çã„Ç∑„É≥„Éó„É´„Å™„Ç´„É¨„É≥„ÉÄ„Éº„ÄÇ' },
                        fr: { title: 'v2.7: Widget Calendrier', description: 'Un calendrier simple pour un aper√ßu des rendez-vous directement sur le tableau de bord.' }
                    }
                },
            ],
            changelog: [
                { 
                    version: "2.5.0", date: "2025-07-01",
                    translations: {
                        de: { changes: ["Vollst√§ndige Inhalts√ºbersetzung (Ank√ºndigungen etc.).", "Neue Sprachen hinzugef√ºgt: Finnisch, Japanisch, Franz√∂sisch.", "Datenstruktur f√ºr einfache Erweiterbarkeit √ºberarbeitet."] },
                        en: { changes: ["Full content translation (announcements, etc.).", "Added new languages: Finnish, Japanese, French.", "Revised data structure for easy scalability."] },
                        fi: { changes: ["T√§ysi sis√§lt√∂k√§√§nn√∂s (ilmoitukset jne.).", "Lis√§tty uusia kieli√§: suomi, japani, ranska.", "Datan rakenne uudistettu helpon laajennettavuuden vuoksi."] },
                        ja: { changes: ["ÂÆåÂÖ®„Å™„Ç≥„É≥„ÉÜ„É≥„ÉÑÁøªË®≥Ôºà„ÅäÁü•„Çâ„Åõ„Å™„Å©Ôºâ„ÄÇ", "Êñ∞„Åó„ÅÑË®ÄË™û„ÇíËøΩÂä†Ôºö„Éï„Ç£„É≥„É©„É≥„ÉâË™û„ÄÅÊó•Êú¨Ë™û„ÄÅ„Éï„É©„É≥„ÇπË™û„ÄÇ", "Á∞°Âçò„Å™Êã°ÂºµÊÄß„ÅÆ„Åü„ÇÅ„ÅÆ„Éá„Éº„ÇøÊßãÈÄ†„ÇíÊîπË®Ç„ÄÇ"] },
                        fr: { changes: ["Traduction compl√®te du contenu (annonces, etc.).", "Ajout de nouvelles langues : finnois, japonais, fran√ßais.", "Structure de donn√©es r√©vis√©e pour une √©volutivit√© facile."] }
                    }
                },
                { 
                    version: "2.4.0", date: "2025-06-30",
                    translations: {
                        de: { changes: ["Komplettes UI-√úbersetzungssystem (DE/EN) hinzugef√ºgt.", "Sprach-Umschalter in den Einstellungen implementiert."] },
                        en: { changes: ["Added full UI translation system (DE/EN).", "Implemented language switcher in settings."] },
                        fi: { changes: ["Lis√§tty t√§ydellinen k√§ytt√∂liittym√§n k√§√§nn√∂sj√§rjestelm√§ (DE/EN).", "Toteutettu kielenvalitsin asetuksiin."] },
                        ja: { changes: ["ÂÆåÂÖ®„Å™UIÁøªË®≥„Ç∑„Çπ„ÉÜ„É†ÔºàDE/ENÔºâ„ÇíËøΩÂä†„ÄÇ", "Ë®≠ÂÆö„Å´Ë®ÄË™ûÂàá„ÇäÊõø„ÅàÊ©üËÉΩ„ÇíÂÆüË£Ö„ÄÇ"] },
                        fr: { changes: ["Ajout d'un syst√®me de traduction complet de l'interface utilisateur (DE/EN).", "Impl√©mentation du s√©lecteur de langue dans les param√®tres."] }
                    }
                }
            ],
        };
        
        // --- APP LOGIC ---

        const defaultSettings = {
            version: APP_VERSION,
            loggedIn: false,
            username: "Gast",
            userAvatar: `https://placehold.co/96x96/e0e7ff/3730a3?text=G`,
            roles: [],
            theme: "light",
            language: "de",
            activeView: "dashboard",
            dashboard: { sectionOrder: ["announcements", "roadmap", "changelog"], layout: "2" },
        };

        let settings = {};
        const dom = { 
            activityBar: document.getElementById('activityBar'), 
            mainContentArea: document.getElementById('mainContentArea'), 
            headerTitle: document.getElementById('headerTitle'), 
            qHubSidebar: document.getElementById('qHubSidebar'), 
            mobileMenuBtn: document.getElementById('mobileMenuBtn'), 
            html: document.documentElement
        };
        
        function t(key, replacements = {}) {
            const keys = key.split('.');
            const lang = translations[settings.language] ? settings.language : 'de';
            let result = keys.reduce((obj, k) => (obj || {})[k], translations[lang]);

            if (!result) {
                result = keys.reduce((obj, k) => (obj || {})[k], translations.en) || key;
            }
            
            for(const placeholder in replacements) {
                result = result.replace(`{${placeholder}}`, replacements[placeholder]);
            }

            return result;
        }

        function init() {
            loadSettings();
            applyTheme();
            applyLanguage();
            updateSpecialFeatures();
            updateUIText();
            renderView(settings.activeView, true);
            setupEventListeners();
        }
        init();

        function loadSettings() {
            const storedSettings = localStorage.getItem(SETTINGS_KEY);
            settings = storedSettings ? { ...defaultSettings, ...JSON.parse(storedSettings) } : { ...defaultSettings };
            if (!Array.isArray(settings.roles)) settings.roles = [];
        }
        
        function saveSettings() {
            settings.version = APP_VERSION;
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
        }

        function renderView(viewId, isInitialLoad = false) {
            if (!isInitialLoad && settings.activeView === viewId) return;
            
            dom.activityBar.querySelectorAll('.activity-btn[data-view]').forEach(btn => btn.classList.toggle('active', btn.dataset.view === viewId));
            dom.qHubSidebar.classList.remove('open');
            dom.mainContentArea.innerHTML = ''; 
            settings.activeView = viewId;
            
            dom.qHubSidebar.classList.add('hidden');
            dom.mobileMenuBtn.classList.add('hidden');
            
            let content = '';
            const title = t(`viewTitles.${viewId}`);

            switch(viewId) {
                case 'dashboard':
                    dom.mobileMenuBtn.classList.remove('hidden');
                    dom.qHubSidebar.classList.remove('hidden');
                    renderDashboardSidebar();
                    renderDashboardContent();
                    break;
                case 'web': content = `<div class="webapp-container"><iframe src="https://quixoticode.github.io"></iframe></div>`; break;
                case 'qcode': content = `<div class="webapp-container"><iframe src="https://quixoticode.github.io/app/QCode/"></iframe></div>`; break;
                case 'qsounds': content = `<div class="webapp-container"><iframe src="https://quixoticode.github.io/app/QSounds/"></iframe></div>`; break;
                case 'qpets': content = `<div class="webapp-container"><iframe src="https://quixoticode.github.io/app/pl"></iframe></div>`; break;
                case 'contact': content = `<div class="webapp-container"><iframe src="https://quixoticode.github.io/contact"></iframe></div>`; break;
                case 'status':
                    content = `<div class="h-full flex flex-col items-center justify-center text-center p-4"><div class="q-card max-w-md"><span class="material-icons text-6xl text-gray-400 mb-4">link_off</span><h2 class="text-xl font-bold mb-2">${t('statusPage.cannot_embed_title')}</h2><p class="text-gray-600 dark:text-gray-300 mb-6">${t('statusPage.cannot_embed_desc')}</p><a href="https://status.quixoticode.de/status/network" target="_blank" class="inline-block px-6 py-3 rounded-lg font-semibold transition" style="background-color: var(--q-primary); color: var(--q-primary-text);">${t('statusPage.open_button')}</a></div></div>`;
                    break;
            }
            
            dom.headerTitle.textContent = title;
            document.title = "QHub - " + title;
            if(content) dom.mainContentArea.innerHTML = content;
            
            saveSettings();
        }

        function applyTheme() { dom.html.setAttribute('data-theme', settings.theme); }
        function applyLanguage() { dom.html.lang = settings.language; }
        
        function updateUIText() {
             dom.activityBar.querySelectorAll('.activity-btn[data-view]').forEach(btn => {
                 btn.title = t(`viewTitles.${btn.dataset.view}`);
             });
             document.getElementById('betaBtn').title = t('viewTitles.beta');
             document.getElementById('settingsBtn').title = t('viewTitles.settings');
        }

        function updateSpecialFeatures() {
            const hasPremium = settings.roles.includes('PREMIUM') || settings.roles.includes('OWNER');
            const hasBeta = settings.roles.includes('BETA');
            dom.activityBar.querySelector('[data-view="qpets"]').classList.toggle('hidden', !hasPremium);
            dom.activityBar.querySelector('#betaBtn').classList.toggle('hidden', !hasBeta);
        }

        function renderDashboardSidebar() {
            const rolesHTML = settings.roles.map(role => `<div class="role-badge ${role.toLowerCase()}" title="${role}">${role}</div>`).join('');
            const sectionsNav = settings.dashboard.sectionOrder.map(id => `<a href="#section-${id}" class="flex items-center gap-3 p-3 rounded-lg capitalize hover:bg-gray-100 dark:hover:bg-gray-700">${t('dashboardModules.'+id+'.title')}</a>`).join('');

            dom.qHubSidebar.innerHTML = `
                <div class="flex items-center gap-3 mb-8">
                    <span class="material-icons text-3xl" style="color: var(--q-primary);">hub</span>
                    <h1 class="text-2xl font-bold">QHub</h1>
                </div>
                <div class="p-4 rounded-lg mb-6 text-center" style="background-color: var(--q-highlight);">
                    <img src="${settings.userAvatar}" class="w-16 h-16 rounded-full mx-auto mb-2 border-2 border-white shadow-md cursor-pointer" id="avatarImg">
                    <h2 class="font-bold text-lg" style="color: var(--q-highlight-text);">${settings.username}</h2>
                    <div class="flex items-center justify-center gap-1 mt-2 flex-wrap">${rolesHTML}</div>
                </div>
                <nav class="flex-grow">
                    <h3 class="px-3 text-sm font-semibold text-gray-400 uppercase tracking-wider mb-2">${t('sidebar.sections')}</h3>
                    ${sectionsNav}
                </nav>`;
        }

        function renderDashboardContent() {
            dom.mainContentArea.innerHTML = `<div id="sectionsContainer" class="space-y-8"></div>`;
            const sectionsContainer = document.getElementById('sectionsContainer');
            const layoutClasses = { '1': 'grid-cols-1', '2': 'md:grid-cols-2', '3': 'lg:grid-cols-3' };
            sectionsContainer.className = `grid gap-6 ${layoutClasses[settings.dashboard.layout] || 'grid-cols-1 md:grid-cols-2'}`;
            const sectionMap = {
                announcements: { icon: 'campaign', renderer: renderAnnouncementsContent },
                roadmap: { icon: 'signpost', renderer: renderRoadmapContent },
                changelog: { icon: 'history', renderer: renderChangelogContent },
            };
            sectionsContainer.innerHTML = settings.dashboard.sectionOrder.map(id => sectionMap[id] ? createSectionHTML(id, t(`dashboardModules.${id}.title`), sectionMap[id].icon, sectionMap[id].renderer) : '').join('');
        }
        
        function createSectionHTML(id, title, icon, renderer) {
            return `<section id="section-${id}" data-section-id="${id}"><div class="flex items-center justify-between mb-4"><h2 class="text-2xl font-bold flex items-center gap-3"><span class="material-icons text-3xl" style="color: var(--q-primary);">${icon}</span>${title}</h2></div><div>${renderer()}</div></section>`;
        }

        // --- UPDATED RENDERING FUNCTIONS FOR DYNAMIC CONTENT ---

        function renderAnnouncementsContent() {
            const hasPremium = settings.roles.includes('PREMIUM') || settings.roles.includes('OWNER');
            const items = dynamicContent.announcements.filter(item => !item.premium || hasPremium);
            if (items.length === 0) return `<div class="q-card text-gray-500">${t('dashboardModules.announcements.none')}</div>`;

            return `<div class="space-y-4">${items.map(item => {
                const translation = item.translations[settings.language] || item.translations.en;
                return `<div class="q-card">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-bold text-lg">${translation.title}</h3>
                        ${item.premium ? `<div class="role-badge premium"><span class="material-icons text-xs">star</span></div>` : ''}
                    </div>
                    <p class="text-gray-600 mt-1">${translation.content}</p>
                    <p class="text-xs text-gray-400 mt-4">${new Date(item.date).toLocaleDateString(settings.language)}</p>
                </div>`;
            }).join('')}</div>`;
        }

        function renderRoadmapContent() {
            const items = dynamicContent.roadmap;
            if (items.length === 0) return `<div class="q-card text-gray-500">${t('dashboardModules.roadmap.none')}</div>`;
            
            const iconMap = { 'in-progress': 'construction', 'planned': 'flag', 'completed': 'check_circle', 'paused': 'pause_circle' };
            return `<div class="q-card"><div class="timeline">${items.map(item => {
                const translation = item.translations[settings.language] || item.translations.en;
                const progressHTML = (item.status === 'in-progress' && item.progress > 0) ? `<div class="mt-2"><div class="flex justify-between text-sm mb-1"><span>${t('dashboardModules.roadmap.progress')}</span><span>${item.progress}%</span></div><div class="w-full progress-bar-bg h-2 rounded-full overflow-hidden"><div class="h-2 progress-bar-fill" style="width: ${item.progress}%;"></div></div></div>` : '';
                return `<div class="timeline-item">
                    <div class="timeline-icon"><span class="material-icons">${iconMap[item.status] || 'info'}</span></div>
                    <h4 class="font-bold text-lg">${translation.title}</h4>
                    <p class="text-gray-600 mt-1">${translation.description}</p>
                    ${progressHTML}
                </div>`;
            }).join('')}</div></div>`;
        }
        
        function renderChangelogContent() {
            const items = dynamicContent.changelog;
            if (items.length === 0) return `<div class="q-card text-gray-500">${t('dashboardModules.changelog.none')}</div>`;

            return `<div class="q-card space-y-6">${items.map(item => {
                const translation = item.translations[settings.language] || item.translations.en;
                const changesHTML = (translation.changes || []).map(change => `<li>${change}</li>`).join('');
                return `<div>
                    <h4 class="font-bold text-lg">${t('dashboardModules.changelog.version')} ${item.version} <span class="text-sm font-normal text-gray-500">- ${new Date(item.date).toLocaleDateString(settings.language)}</span></h4>
                    <ul class="list-disc list-inside mt-2 text-sm text-gray-600 space-y-1">${changesHTML}</ul>
                </div>`;
            }).join('')}</div>`;
        }
        
        function setupEventListeners() {
            dom.activityBar.addEventListener('click', e => {
                const btn = e.target.closest('.activity-btn[data-view]');
                if (btn) renderView(btn.dataset.view);
            });
            document.getElementById('betaBtn').addEventListener('click', () => window.open('https://quixoticode.github.io/beta/app', '_blank'));
            document.getElementById('settingsBtn').addEventListener('click', renderAndShowSettingsModal);
            dom.mobileMenuBtn.addEventListener('click', () => dom.qHubSidebar.classList.toggle('open'));
        }
        
        function renderAndShowSettingsModal() {
            const modal = document.getElementById('settingsModal');
            const themeOptions = ['light', 'dark'];
            const langOptions = [
                { code: 'de', name: 'Deutsch', flag: 'https://flagcdn.com/de.svg' },
                { code: 'en', name: 'English', flag: 'https://flagcdn.com/gb.svg' },
                { code: 'fr', name: 'Fran√ßais', flag: 'https://flagcdn.com/fr.svg' },
                { code: 'fi', name: 'Suomi', flag: 'https://flagcdn.com/fi.svg' },
                { code: 'ja', name: 'Êó•Êú¨Ë™û', flag: 'https://flagcdn.com/jp.svg' }
            ];

            modal.innerHTML = `
                <div class="q-modal-content">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">${t('settingsModal.title')}</h2>
                        <button id="closeSettingsModal" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 material-icons">close</button>
                    </div>
                    <div class="space-y-6">
                        <!-- Account Section -->
                        <div>
                            <label class="font-semibold block mb-2">${t('settingsModal.account')}</label>
                            ${settings.loggedIn 
                                ? `<div class="space-y-2"><div class="p-4 rounded-md bg-green-100 dark:bg-green-900 dark:text-green-100 text-green-800 text-center">${t('settingsModal.loggedInAs')} ${settings.username}</div><button id="logoutBtn" class="w-full p-2 text-center border rounded-md hover:bg-red-100 dark:hover:bg-red-800">${t('settingsModal.logout')}</button></div>` 
                                : `<div class="space-y-4 p-4 border rounded-md">
                                    <h4 class="font-medium">${t('settingsModal.login')}</h4>
                                    <div><label class="text-sm">${t('settingsModal.username')}</label><input id="loginUser" type="text" class="w-full p-2 border rounded mt-1 bg-transparent" placeholder="${t('settingsModal.username')}"></div>
                                    <div><label class="text-sm">${t('settingsModal.password')}</label><input id="loginPass" type="password" class="w-full p-2 border rounded mt-1 bg-transparent"></div>
                                    <button id="loginBtn" class="w-full p-2 text-center text-white rounded-md" style="background-color: var(--q-primary); color: var(--q-primary-text);">${t('settingsModal.login')}</button>
                                   </div>`
                            }
                        </div>
                        <!-- Appearance Section -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="themeSelector" class="font-semibold block mb-2">${t('settingsModal.theme')}</label>
                                <select id="themeSelector" class="w-full p-2 border rounded bg-transparent">${themeOptions.map(th => `<option value="${th}" ${settings.theme === th ? 'selected' : ''} class="capitalize bg-white dark:bg-black">${th}</option>`).join('')}</select>
                            </div>
                            <div>
                                <label for="languageSelectorBtn" class="font-semibold block mb-2">${t('settingsModal.language')}</label>
                                <div class="relative">
                                    <button id="languageSelectorBtn" class="w-full p-2 border rounded text-left flex justify-between items-center bg-transparent">
                                        <span id="selectedLanguageText" class="flex items-center gap-2"></span>
                                        <span class="material-icons">unfold_more</span>
                                    </button>
                                    <div id="languageDropdown" class="hidden absolute bottom-full mb-1 w-full rounded-md shadow-lg border z-10" style="background-color: var(--q-surface);">
                                        ${langOptions.map(lang => `<div data-lang="${lang.code}" class="lang-option p-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer flex items-center gap-2">
                                            <img src="${lang.flag}" width="20" alt="${lang.name} flag"> ${lang.name}
                                        </div>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
            
            // Event Listeners for Modal
            modal.querySelector('#closeSettingsModal').addEventListener('click', () => toggleModal('settingsModal', false));
            modal.querySelector('#themeSelector').addEventListener('change', (e) => { settings.theme = e.target.value; applyTheme(); saveSettings(); });
            modal.querySelector('#loginBtn')?.addEventListener('click', handleLogin);
            modal.querySelector('#logoutBtn')?.addEventListener('click', handleLogout);

            const langBtn = modal.querySelector('#languageSelectorBtn');
            const langDropdown = modal.querySelector('#languageDropdown');
            const selectedLangText = modal.querySelector('#selectedLanguageText');
            
            function updateLangButton() {
                const currentLang = langOptions.find(l => l.code === settings.language) || langOptions[0];
                selectedLangText.innerHTML = `<img src="${currentLang.flag}" width="20" alt="${currentLang.name} flag"> ${currentLang.name}`;
            }
            updateLangButton();

            langBtn.addEventListener('click', () => langDropdown.classList.toggle('hidden'));
            
            modal.querySelectorAll('.lang-option').forEach(option => {
                option.addEventListener('click', () => {
                    const newLang = option.dataset.lang;
                    langDropdown.classList.add('hidden');
                    if (newLang !== settings.language) {
                        settings.language = newLang;
                        saveSettings();
                        applyLanguage();
                        updateUIText();
                        renderView(settings.activeView, true);
                        renderAndShowSettingsModal(); 
                    }
                });
            });

            toggleModal('settingsModal', true);
        }

        async function handleLogin() {
            const usernameInput = document.getElementById('loginUser').value.trim().toLowerCase();
            const passInput = document.getElementById('loginPass').value;
            const loginButton = document.getElementById('loginBtn');

            if (!usernameInput) { showToast(t('toasts.enter_username'), 'error'); return; }
            if (!passInput) { showToast(t('toasts.enter_password'), 'error'); return; }

            loginButton.disabled = true;
            loginButton.innerHTML = t('login.checking');

            try {
                const response = await fetch(`https://quixoticode.github.io/data/s/name.json`);
                if (!response.ok) throw new Error(`${t('toasts.user_not_found')} (${response.status})`);
                
                const data = await response.json();
                let userFound = null;
                let finalUsername = usernameInput;

                if (data.users[usernameInput] && data.users[usernameInput].password === passInput) {
                    userFound = data.users[usernameInput];
                } else if (data.one_time_codes[passInput] && data.one_time_codes[passInput].username.toLowerCase() === usernameInput) {
                    userFound = data.users[usernameInput];
                    finalUsername = data.one_time_codes[passInput].username;
                }

                if (userFound) {
                    settings.loggedIn = true;
                    settings.username = finalUsername;
                    settings.roles = userFound.roles || [];
                    settings.userAvatar = userFound.avatar || defaultSettings.userAvatar;
                    saveSettings();
                    updateSpecialFeatures();
                    renderView('dashboard', true);
                    toggleModal('settingsModal', false);
                    showToast(t('toasts.welcome', {username: settings.username}), 'success');
                } else {
                    throw new Error(t('toasts.login_error'));
                }
            } catch (error) {
                console.error("Login Error:", error);
                showToast(error.message, 'error');
                loginButton.disabled = false;
                loginButton.innerHTML = t('settingsModal.login');
            }
        }

        function handleLogout() {
            const currentTheme = settings.theme;
            const currentLang = settings.language;
            settings = { ...defaultSettings, theme: currentTheme, language: currentLang };
            saveSettings();
            updateSpecialFeatures();
            renderView('dashboard', true);
            toggleModal('settingsModal', false);
            showToast(t('toasts.logout_success'), 'info');
        }

        function toggleModal(modalId, show) { document.getElementById(modalId).classList.toggle('visible', show); }
        
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `px-4 py-3 rounded-lg text-white shadow-lg transition-all duration-300 transform translate-y-4 opacity-0`;
            toast.textContent = message;
            if (type === 'success') toast.style.backgroundColor = `var(--q-primary)`;
            else if (type === 'error') toast.style.backgroundColor = `var(--q-danger)`;
            else toast.style.backgroundColor = `var(--q-on-surface-variant)`;
            container.appendChild(toast);
            requestAnimationFrame(() => {
                toast.classList.remove('translate-y-4', 'opacity-0');
                toast.classList.add('translate-y-0', 'opacity-100');
            });
            setTimeout(() => {
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('translate-y-4', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
    });
    </script>
</body>
</html>
