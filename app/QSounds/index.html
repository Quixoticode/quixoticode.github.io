<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
    <meta charset="UTF-8">
    <title>QSounds v1.1.1 â€“ RSA Encrypting Tool (Material You)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Sharp|Material+Icons+Round" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://quixoticode.github.io/data/qsounds/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="https://quixoticode.github.io/data/qsounds/favicon.svg" />
    <link rel="shortcut icon" href="https://quixoticode.github.io/data/qsounds/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="https://quixoticode.github.io/data/qsounds/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="QSounds" />
    <link rel="manifest" href="https://quixoticode.github.io/data/qsounds/site.webmanifest" />

    <style>
        :root {
            --font-family-sans: 'Roboto', 'Inter', 'Segoe UI', sans-serif;
            
            --color-primary: #6200EE; 
            --color-primary-variant: #3700B3;
            --color-secondary: #03DAC6;
            --color-secondary-variant: #018786;

            --color-background: #FFFFFF;
            --color-surface: #FFFFFF;
            --color-on-primary: #FFFFFF;
            --color-on-secondary: #000000;
            --color-on-background: #000000;
            --color-on-surface: #000000;
            --color-on-surface-variant: #757575; 
            --color-outline: #dbdbdb;
            --color-error: #B00020;

            --sidebar-width: 290px;
            --sidebar-bg: #F8F9FA; 
            --sidebar-text-color: var(--color-on-surface);
            --sidebar-icon-color: var(--color-on-surface-variant);
            --sidebar-link-hover-bg: #E9ECEF;
            --sidebar-link-active-bg: var(--color-secondary);
            --sidebar-link-active-text: var(--color-on-secondary);
            --sidebar-border-color: #E0E0E0;

            --elevation-1: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --elevation-2: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --elevation-3: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            
            --border-radius-small: 8px;
            --border-radius-medium: 16px;
            --border-radius-large: 28px; 
            --border-radius-full: 9999px;
        }

        [data-theme="dark"] {
            --color-primary: #BB86FC;
            --color-primary-variant: #6A0DAD; 
            --color-secondary: #03DAC6; 
            --color-secondary-variant: #03DAC6;

            --color-background: #121212;
            --color-surface: #1E1E1E; 
            --color-on-primary: #000000;
            --color-on-secondary: #000000;
            --color-on-background: #FFFFFF;
            --color-on-surface: #FFFFFF;
            --color-on-surface-variant: #BDBDBD;
            --color-outline: #424242;
            --color-error: #CF6679;

            --sidebar-bg: #212121;
            --sidebar-text-color: var(--color-on-surface);
            --sidebar-icon-color: var(--color-on-surface-variant);
            --sidebar-link-hover-bg: #333333;
            --sidebar-link-active-bg: var(--color-secondary);
            --sidebar-link-active-text: var(--color-on-secondary);
            --sidebar-border-color: #303030;
        }

        body {
            margin: 0; padding: 0; font-family: var(--font-family-sans);
            background-color: var(--color-background); color: var(--color-on-background);
            transition: background-color 0.3s, color 0.3s, margin-left 0.3s ease-in-out;
            overflow-x: hidden;
        }

        .sidebar-toggle-button {
            position: fixed; top: 1rem; left: 1rem; z-index: 1050;
            background-color: var(--color-surface); color: var(--color-primary);
            border: 1px solid var(--color-outline);
            cursor: pointer; padding: 0.6rem; display: flex; align-items: center; justify-content: center;
            border-radius: var(--border-radius-full); box-shadow: var(--elevation-2);
            transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease;
            opacity: 1;
        }
        .sidebar-toggle-button.hidden-when-sidebar-open { opacity: 0; pointer-events: none; }
        .sidebar-toggle-button:hover { background-color: var(--sidebar-link-hover-bg); box-shadow: var(--elevation-3); }
        .sidebar-toggle-button .material-icons, .sidebar-toggle-button .material-icons-outlined { font-size: 26px; }

        .q-sidebar {
            position: fixed; top: 0; left: 0; height: 100vh;
            width: var(--sidebar-width); background-color: var(--sidebar-bg);
            color: var(--sidebar-text-color); padding-top: 1rem;
            box-shadow: var(--elevation-3); transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000; display: flex; flex-direction: column;
            border-right: 1px solid var(--sidebar-border-color);
        }
        .q-sidebar.open { transform: translateX(0); }

        .q-sidebar-header {
            padding: 0.5rem 1rem 1rem 1.5rem; display: flex; align-items: center;
            justify-content: space-between; margin-bottom: 0.5rem; min-height: 64px; box-sizing: border-box;
        }
        .logo-title-group { display: flex; align-items: center; }
        .q-sidebar-header .logo-icon { font-size: 2.2rem; margin-right: 0.75rem; color: var(--color-primary); }
        .q-sidebar-header h2 { margin: 0; font-size: 1.35em; font-weight: 500; color: var(--sidebar-text-color); }
        
        .sidebar-internal-toggle {
            background: none; border: none; color: var(--sidebar-icon-color);
            cursor: pointer; padding: 0.5rem; display: flex; align-items: center;
            justify-content: center; border-radius: var(--border-radius-full);
        }
        .sidebar-internal-toggle:hover { background-color: var(--sidebar-link-hover-bg); color: var(--color-primary); }
        .sidebar-internal-toggle .material-icons-outlined { font-size: 24px; }

        .q-sidebar-nav { flex-grow: 1; overflow-y: auto; padding: 0 0.75rem; }
        .q-sidebar-nav ul { list-style: none; padding: 0; margin: 0; }
        .q-sidebar-nav li .nav-link, .q-sidebar-nav li .stored-key-item-container .stored-key-item-main {
            display: flex; align-items: center; justify-content: space-between;
            padding: 0.8rem 1rem; color: var(--sidebar-text-color); text-decoration: none;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-radius: var(--border-radius-large); margin: 0.3rem 0; font-weight: 500;
            cursor: pointer;
        }
        .q-sidebar-nav li .nav-link:hover, .q-sidebar-nav li .stored-key-item-container .stored-key-item-main:hover {
            background-color: var(--sidebar-link-hover-bg);
        }
        .q-sidebar-nav li .nav-link.active, .q-sidebar-nav li .stored-key-item-container .stored-key-item-main.active {
            background-color: var(--sidebar-link-active-bg); color: var(--sidebar-link-active-text);
            font-weight: 700;
        }
        .q-sidebar-nav li .nav-link.active .material-icons, 
        .q-sidebar-nav li .stored-key-item-container .stored-key-item-main.active .material-icons { color: var(--sidebar-link-active-text); }
        
        .q-sidebar-nav li .nav-link .material-icons, 
        .q-sidebar-nav li .stored-key-item-container .stored-key-item-main .material-icons {
            margin-right: 1.25rem; color: var(--sidebar-icon-color);
            font-size: 22px; transition: color 0.2s ease;
        }
        .q-sidebar-nav li .stored-key-item-container .stored-key-item-main .key-name { 
            flex-grow: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-size: 0.9em; 
        }
        .q-sidebar-nav li .nav-link:hover .material-icons, 
        .q-sidebar-nav li .stored-key-item-container .stored-key-item-main:hover .material-icons { color: var(--color-primary); }
        
        .stored-key-actions {
            display: none; 
            padding: 0.5rem 1rem 0.5rem 3.5rem; 
            background-color: rgba(0,0,0,0.03);
            border-radius: 0 0 var(--border-radius-medium) var(--border-radius-medium);
            margin-top: -0.25rem;
            margin-bottom: 0.25rem;
        }
        .stored-key-item-container.actions-visible .stored-key-actions { display: flex; gap: 0.5rem; justify-content: flex-start; }
        [data-theme="dark"] .stored-key-actions { background-color: rgba(255,255,255,0.04); }

        .stored-key-actions button {
            background: none; border: none; color: var(--sidebar-icon-color); cursor: pointer; 
            padding: 0.3rem; border-radius: var(--border-radius-full);
            display: flex; align-items: center; font-size: 0.85em;
        }
        .stored-key-actions button .material-icons { font-size: 18px; margin-right: 0.3rem;}
        .stored-key-actions button:hover { color: var(--color-primary); background-color: var(--sidebar-link-hover-bg); }
        .stored-key-actions button.delete:hover { color: var(--color-error); }


        .q-sidebar-section-title {
            padding: 1.5rem 1rem 0.5rem 1rem; font-size: 0.8rem;
            font-weight: 700; color: var(--color-primary);
            text-transform: uppercase; letter-spacing: 0.075em;
        }
        .q-sidebar-footer { padding: 1rem; border-top: 1px solid var(--sidebar-border-color); }

        .content-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.3); backdrop-filter: blur(4px);
            z-index: 999; opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .content-overlay.active { opacity: 1; visibility: visible; }

        .qsounds-main-content { margin-left: 0; transition: margin-left 0.3s ease-in-out; padding: 1.5rem; }
        body.sidebar-open .qsounds-main-content { margin-left: var(--sidebar-width); }
        @media (max-width: 992px) { 
            body.sidebar-open .qsounds-main-content { margin-left: 0; }
            .qsounds-main-content { padding: 1rem; }
            .q-sidebar { box-shadow: var(--elevation-3); border-right: none;}
        }

        .modal-backdrop {
            position: fixed; inset: 0; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(2px);
            z-index: 1040; display: flex; align-items: center; justify-content: center; padding: 1rem;
        }
        .modal-content {
            background-color: var(--color-surface); color: var(--color-on-surface);
            padding: 1.75rem; border-radius: var(--border-radius-large);
            box-shadow: var(--elevation-3);
            min-width: 320px; max-width: 95%; width: 560px;
        }
        .modal-content h2 { color: var(--color-primary); margin-top: 0; margin-bottom: 1rem; font-size: 1.5em; font-weight: 500;}
        .modal-content label { color: var(--color-on-surface-variant); font-size: 0.9em; margin-bottom: 0.25rem; display: block;}
        .modal-content input[type="color"] { border-radius: var(--border-radius-small); border: 1px solid var(--color-outline); height: 48px; }

        .qs-input, .qs-textarea {
            background-color: var(--color-surface); color: var(--color-on-surface);
            border: 1px solid var(--color-outline);
            border-radius: var(--border-radius-small); padding: 0.9rem 1rem;
            width: 100%; font-size: 1rem; line-height: 1.5;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .qs-input:focus, .qs-textarea:focus {
            border-color: var(--color-primary); outline: none;
            box-shadow: 0 0 0 2px color-mix(in srgb, var(--color-primary) 30%, transparent);
        }
        .qs-textarea { min-height: 120px; }

        .qs-button {
            background-color: var(--color-primary); color: var(--color-on-primary);
            padding: 0.75rem 1.5rem; border-radius: var(--border-radius-full); font-weight: 500;
            text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.9rem;
            border: none; cursor: pointer; transition: background-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: var(--elevation-1);
        }
        .qs-button:hover { background-color: var(--color-primary-variant); box-shadow: var(--elevation-2); }
        
        .qs-button-secondary {
            background-color: transparent; color: var(--color-primary);
            border: 1px solid var(--color-outline);
            padding: 0.7rem 1.45rem; border-radius: var(--border-radius-full); font-weight: 500;
            text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.9rem;
            cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .qs-button-secondary:hover { background-color: color-mix(in srgb, var(--color-primary) 8%, transparent); border-color: var(--color-primary); }

        .qs-button-text {
             background-color: transparent; color: var(--color-primary);
             padding: 0.7rem 1rem; border-radius: var(--border-radius-small); font-weight: 500;
             text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.9rem;
             border: none; cursor: pointer; transition: background-color 0.2s ease;
        }
        .qs-button-text:hover { background-color: color-mix(in srgb, var(--color-primary) 8%, transparent); }


        .card {
            background-color: var(--color-surface);
            border-radius: var(--border-radius-medium);
            padding: 1.5rem;
            box-shadow: var(--elevation-1);
            transition: box-shadow 0.3s ease-in-out;
        }
        .card:hover { box-shadow: var(--elevation-2); }
        .card-title {
            font-size: 1.4em; font-weight: 500; color: var(--color-primary);
            margin-bottom: 1.25rem; display: flex; align-items: center;
        }
        .card-title .material-icons { margin-right: 0.75rem; font-size: 1.8rem; }
        
        .app-header { margin-bottom: 2rem; }
        .app-header h1 { font-size: 2.5rem; font-weight: 700; color: var(--color-primary); }
        .app-header p { font-size: 1.1rem; color: var(--color-on-surface-variant); }

        .form-field { margin-bottom: 1.25rem; }
        .form-field label {
            display: block; font-size: 0.9rem; font-weight: 500;
            color: var(--color-on-surface-variant); margin-bottom: 0.5rem;
        }
        .key-display-area textarea { font-family: 'Roboto Mono', monospace; font-size: 0.8rem; background-color: var(--color-background) !important; }
        
        .message-area { min-height: 1.5em; font-size: 0.9em; margin-top: 0.75rem; color: var(--color-secondary); }
    </style>
</head>
<body>

    <button class="sidebar-toggle-button" id="sidebarToggle" aria-label="Navigation Ã¶ffnen/schlieÃŸen" aria-expanded="false">
        <span class="material-icons-outlined">menu</span>
    </button>

    <nav class="q-sidebar" id="qSoundsSidebar">
        <div class="q-sidebar-header">
            <div class="logo-title-group">
                <img src="https://quixoticode.github.io/data/qsounds/favicon-96x96.png" alt=""> <h2>QSounds</h2>
            </div>
            <button class="sidebar-internal-toggle" id="sidebarInternalToggle" aria-label="Navigation schlieÃŸen">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>

        <div class="q-sidebar-nav">
            <div class="q-sidebar-section-title">Navigation</div>
            <ul>
                <li><a class="nav-link" href="#" onclick="scrollToElement('keyManagementSection'); closeSidebarAfterAction(); return false;"><span class="material-icons">vpn_key</span> SchlÃ¼sselverwaltung</a></li>
                <li><a class="nav-link" href="#" onclick="scrollToElement('encryptionSection'); closeSidebarAfterAction(); return false;"><span class="material-icons">lock</span> VerschlÃ¼sseln</a></li>
                <li><a class="nav-link" href="#" onclick="scrollToElement('decryptionSection'); closeSidebarAfterAction(); return false;"><span class="material-icons">lock_open</span> EntschlÃ¼sseln</a></li>
            </ul>

            <div class="q-sidebar-section-title">Meine SchlÃ¼ssel</div>
            <ul id="storedKeysList">
            </ul>
            <ul>
                 <li><a class="nav-link" href="#" onclick="importKeyPairFile(); closeSidebarAfterAction(); return false;"><span class="material-icons">file_upload</span> SchlÃ¼sselpaar importieren</a></li>
            </ul>


            <div class="q-sidebar-section-title">App Daten</div>
            <ul>
                <li><a class="nav-link" href="#" onclick="exportTextData(); closeSidebarAfterAction(); return false;"><span class="material-icons">description</span> Text exportieren</a></li>
                <li><a class="nav-link" href="#" onclick="exportCurrentKeyPairData(); closeSidebarAfterAction(); return false;"><span class="material-icons">key</span> Aktuelles Paar exportieren</a></li>
            </ul>

            <div class="q-sidebar-section-title">Einstellungen</div>
            <ul>
                <li><a class="nav-link" href="#" onclick="toggleTheme(); closeSidebarAfterAction(false); return false;"><span class="material-icons">brightness_6</span> Modus wechseln</a></li>
                <li><a class="nav-link" href="#" onclick="showThemePopup(); closeSidebarAfterAction(); return false;"><span class="material-icons">palette</span> Theme Editor</a></li>
            </ul>
        </div>
        
        <div class="q-sidebar-footer">
             <div class="q-sidebar-section-title" style="padding-top: 0.5rem; padding-bottom: 0.2rem;">Info</div>
             <ul>
                <li><a class="nav-link" href="#" onclick="showCurrentChangelog(); closeSidebarAfterAction(); return false;"><span class="material-icons">article</span> Changelog</a></li>
                <li><a class="nav-link" href="README.md" target="_blank" rel="noopener noreferrer"><span class="material-icons">help_outline</span> ReadMe</a></li>
             </ul>
        </div>
    </nav>

    <div class="content-overlay" id="contentOverlay"></div>

    <main class="qsounds-main-content">
        <header class="app-header text-center">
            <h1>QSounds <span class="text-2xl font-normal">v<span id="displayed-version">1.1</span></span></h1>
            <p>Sichere RSA-VerschlÃ¼sselung fÃ¼r Ihre Nachrichten und SchlÃ¼ssel.</p>
        </header>

        <div class="space-y-8">
            <section id="keyManagementSection" class="card">
                <h2 class="card-title"><span class="material-icons">vpn_key</span>RSA SchlÃ¼sselverwaltung</h2>
                <div class="flex flex-wrap gap-3 mb-6">
                    <button id="generateKeysButton" class="qs-button">Neues SchlÃ¼sselpaar generieren</button>
                    <button id="saveCurrentKeysButton" class="qs-button-secondary">Aktuelles Paar in Sidebar speichern</button>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6 key-display-area">
                    <div class="form-field">
                        <label for="publicKeyOutput">Ã–ffentlicher SchlÃ¼ssel:</label>
                        <textarea id="publicKeyOutput" readonly class="qs-textarea"></textarea>
                        <button onclick="copyToClipboard('publicKeyOutput', 'Ã–ffentlicher SchlÃ¼ssel')" class="qs-button-text mt-2">Kopieren</button>
                    </div>
                    <div class="form-field">
                        <label for="privateKeyOutput">Privater SchlÃ¼ssel:</label>
                        <textarea id="privateKeyOutput" readonly class="qs-textarea"></textarea>
                        <button onclick="copyToClipboard('privateKeyOutput', 'Privater SchlÃ¼ssel')" class="qs-button-text mt-2">Kopieren</button>
                    </div>
                </div>
                 <p id="keyMessage" class="message-area"></p>
            </section>

            <section id="encryptionSection" class="card">
                <h2 class="card-title"><span class="material-icons">lock</span>VerschlÃ¼sseln</h2>
                <div class="space-y-6">
                    <div class="form-field">
                        <label for="textToEncryptInput">Zu verschlÃ¼sselnder Text:</label>
                        <textarea id="textToEncryptInput" placeholder="Geben Sie hier Ihren Klartext ein..." class="qs-textarea"></textarea>
                    </div>
                    <div class="form-field">
                        <label for="publicKeyForEncryptInput">Ã–ffentlicher SchlÃ¼ssel fÃ¼r die VerschlÃ¼sselung:</label>
                        <textarea id="publicKeyForEncryptInput" placeholder="Ã–ffentlichen SchlÃ¼ssel hier einfÃ¼gen..." class="qs-textarea key-display-area"></textarea>
                    </div>
                    <button id="encryptButton" class="qs-button">Text verschlÃ¼sseln</button>
                    <div class="form-field mt-4">
                        <label for="encryptedOutput">VerschlÃ¼sselte Ausgabe (Base64):</label>
                        <textarea id="encryptedOutput" readonly class="qs-textarea key-display-area"></textarea>
                         <button onclick="copyToClipboard('encryptedOutput', 'VerschlÃ¼sselter Text')" class="qs-button-text mt-2">Kopieren</button>
                    </div>
                     <p id="encryptMessage" class="message-area"></p>
                </div>
            </section>

            <section id="decryptionSection" class="card">
                <h2 class="card-title"><span class="material-icons">lock_open</span>EntschlÃ¼sseln</h2>
                <div class="space-y-6">
                    <div class="form-field">
                        <label for="textToDecryptInput">Zu entschlÃ¼sselnder Chiffretext (Base64):</label>
                        <textarea id="textToDecryptInput" placeholder="Base64-kodierten Chiffretext hier einfÃ¼gen..." class="qs-textarea key-display-area"></textarea>
                    </div>
                    <div class="form-field">
                        <label for="privateKeyForDecryptInput">Privater SchlÃ¼ssel fÃ¼r die EntschlÃ¼sselung:</label>
                        <textarea id="privateKeyForDecryptInput" placeholder="Privaten SchlÃ¼ssel hier einfÃ¼gen..." class="qs-textarea key-display-area"></textarea>
                    </div>
                    <button id="decryptButton" class="qs-button">Text entschlÃ¼sseln</button>
                    <div class="form-field mt-4">
                        <label for="decryptedOutput">EntschlÃ¼sselte Ausgabe:</label>
                        <textarea id="decryptedOutput" readonly class="qs-textarea"></textarea>
                    </div>
                     <p id="decryptMessage" class="message-area"></p>
                </div>
            </section>
        </div>

        <footer class="text-center py-10 mt-8">
            <p class="text-sm" style="color: var(--color-on-surface-variant);">Erstellt mit <span class="material-icons text-sm text-red-500 inline-block align-middle">favorite</span> von <a href="https://github.com/Quixoticode" target="_blank" rel="noopener noreferrer" class="font-medium hover:underline" style="color: var(--color-primary);">Quixoticode</a></p>
        </footer>
    </main>

    <div id="version-info-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h2 class="flex items-center"><span class="material-icons-outlined mr-3">campaign</span>Neueste Ã„nderungen (Version <span id="current-version-modal">1.1</span>)</h2>
            <div id="changelog-content" class="text-sm space-y-1 my-6 max-h-72 overflow-y-auto pr-2"></div>
            <div class="flex justify-end">
                <button id="close-changelog" class="qs-button">Verstanden</button>
            </div>
        </div>
    </div>

    <div id="themePopup" class="modal-backdrop hidden">
        <div class="modal-content">
            <h2 class="flex items-center"><span class="material-icons-outlined mr-3">palette</span>Theme Editor</h2>
            <div class="space-y-5 my-6">
                <div>
                    <label for="primaryColor">PrimÃ¤re Akzentfarbe (z.B. Buttons):</label>
                    <input type="color" id="primaryColor" class="w-full">
                </div>
                <div>
                    <label for="secondaryColor">SekundÃ¤re Akzentfarbe (z.B. aktive Sidebar-Links):</label>
                    <input type="color" id="secondaryColor" class="w-full">
                </div>
            </div>
            <div class="flex justify-end gap-3">
                <button onclick="closeModal('themePopup')" class="qs-button-text">Abbrechen</button>
                <button onclick="saveTheme()" class="qs-button">Speichern</button>
            </div>
        </div>
    </div>
    
    <div id="devPortal" class="fixed inset-0 bg-black bg-opacity-95 text-lime-400 p-4 font-mono z-[1060] hidden overflow-auto text-xs">
        <div class="flex justify-between items-center mb-3">
            <h2 class="text-xl">Entwicklerportal</h2>
            <button onclick="document.getElementById('devPortal').style.display='none'" class="bg-lime-500 text-black py-1 px-3 rounded hover:bg-lime-600 text-sm">SchlieÃŸen</button>
        </div>
        <pre id="devLog" class="bg-gray-900 p-3 h-72 overflow-y-auto border border-lime-700 rounded-md"></pre>
    </div>

    <script>
        const sidebar = document.getElementById('qSoundsSidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebarInternalToggle = document.getElementById('sidebarInternalToggle');
        const contentOverlay = document.getElementById('contentOverlay');
        
        const publicKeyOutput = document.getElementById('publicKeyOutput');
        const privateKeyOutput = document.getElementById('privateKeyOutput');
        const generateKeysButton = document.getElementById('generateKeysButton');
        const saveCurrentKeysButton = document.getElementById('saveCurrentKeysButton');
        const keyMessage = document.getElementById('keyMessage');

        const textToEncryptInput = document.getElementById('textToEncryptInput');
        const publicKeyForEncryptInput = document.getElementById('publicKeyForEncryptInput');
        const encryptButton = document.getElementById('encryptButton');
        const encryptedOutput = document.getElementById('encryptedOutput');
        const encryptMessage = document.getElementById('encryptMessage');

        const textToDecryptInput = document.getElementById('textToDecryptInput');
        const privateKeyForDecryptInput = document.getElementById('privateKeyForDecryptInput');
        const decryptButton = document.getElementById('decryptButton');
        const decryptedOutput = document.getElementById('decryptedOutput');
        const decryptMessage = document.getElementById('decryptMessage');

        const versionInfoModal = document.getElementById('version-info-modal');
        const changelogContentEl = document.getElementById('changelog-content');
        const currentVersionModalSpan = document.getElementById('current-version-modal');
        const displayedVersionSpan = document.getElementById('displayed-version');
        const closeChangelogButton = document.getElementById('close-changelog');
        
        const themePopup = document.getElementById('themePopup');
        const primaryColorInput = document.getElementById('primaryColor');
        const secondaryColorInput = document.getElementById('secondaryColor');

        const devLog = document.getElementById('devLog');
        const storedKeysListUI = document.getElementById('storedKeysList');

        const currentAppVersion = '1.0.0'; // ZurÃ¼ckgesetzt auf 1.1
        const lastSeenVersionKey = 'lastSeenAppVersion_QSounds_Material_v1_1_revised'; // Angepasster Key fÃ¼r localStorage
        const storedKeysLocalStorageKey = 'qs_rsa_keys_list_material_v1_1_revised'; // Angepasster Key fÃ¼r localStorage
        const themeLocalStorageKey = "qs_theme_material_v1_1_revised"; // Angepasster Key fÃ¼r Theme
        const themePreferenceLocalStorageKey = "qs_theme_preference_material_v1_1_revised"; // Angepasster Key fÃ¼r Theme PrÃ¤ferenz

        let rsa = new JSEncrypt({ default_key_size: 2048 });

        function generateRSAKeyPair() {
            appendDevLog('Generiere RSA SchlÃ¼sselpaar (2048 bit)...');
            keyMessage.textContent = 'Generiere SchlÃ¼ssel... bitte warten.';
            try {
                rsa = new JSEncrypt({ default_key_size: 2048 });
                const privateK = rsa.getPrivateKey();
                const publicK = rsa.getPublicKey();

                publicKeyOutput.value = publicK;
                privateKeyOutput.value = privateK;
                publicKeyForEncryptInput.value = publicK;
                privateKeyForDecryptInput.value = privateK;

                keyMessage.textContent = 'Neues RSA SchlÃ¼sselpaar erfolgreich generiert!';
                appendDevLog('RSA SchlÃ¼sselpaar generiert.');
                setTimeout(() => keyMessage.textContent = '', 4000);
            } catch (error) {
                keyMessage.textContent = 'Fehler beim Generieren der SchlÃ¼ssel. Siehe Konsole.';
                appendDevLog(`Fehler beim Generieren der RSA SchlÃ¼ssel: ${error.message || error}`);
            }
        }

        function encryptRSA() {
            const plainText = textToEncryptInput.value;
            const publicKey = publicKeyForEncryptInput.value;
            encryptMessage.textContent = '';

            if (!plainText) { encryptMessage.textContent = 'Bitte Text zum VerschlÃ¼sseln eingeben.'; return; }
            if (!publicKey) { encryptMessage.textContent = 'Bitte einen Ã¶ffentlichen SchlÃ¼ssel fÃ¼r die VerschlÃ¼sselung angeben.'; return; }

            try {
                const encryptor = new JSEncrypt();
                encryptor.setPublicKey(publicKey);
                const ciphertext = encryptor.encrypt(plainText);

                if (ciphertext) {
                    encryptedOutput.value = ciphertext;
                    encryptMessage.textContent = 'Text erfolgreich verschlÃ¼sselt.';
                    appendDevLog('Text verschlÃ¼sselt.');
                } else {
                    encryptedOutput.value = '';
                    encryptMessage.textContent = 'VerschlÃ¼sselung fehlgeschlagen. Ist der Ã¶ffentliche SchlÃ¼ssel gÃ¼ltig und der Text nicht zu lang?';
                    appendDevLog('VerschlÃ¼sselung fehlgeschlagen.');
                }
            } catch (error) {
                encryptedOutput.value = '';
                encryptMessage.textContent = `VerschlÃ¼sselungsfehler: ${error.message || error}.`;
                appendDevLog(`VerschlÃ¼sselungsfehler: ${error.message || error}`);
            }
            setTimeout(() => encryptMessage.textContent = '', 5000);
        }

        function decryptRSA() {
            const ciphertext = textToDecryptInput.value;
            const privateKey = privateKeyForDecryptInput.value;
            decryptMessage.textContent = '';

            if (!ciphertext) { decryptMessage.textContent = 'Bitte Chiffretext zum EntschlÃ¼sseln eingeben.'; return; }
            if (!privateKey) { decryptMessage.textContent = 'Bitte einen privaten SchlÃ¼ssel fÃ¼r die EntschlÃ¼sselung angeben.'; return; }

            try {
                const decryptor = new JSEncrypt();
                decryptor.setPrivateKey(privateKey);
                const plaintext = decryptor.decrypt(ciphertext);

                if (plaintext) {
                    decryptedOutput.value = plaintext;
                    decryptMessage.textContent = 'Text erfolgreich entschlÃ¼sselt.';
                    appendDevLog('Text entschlÃ¼sselt.');
                } else {
                    decryptedOutput.value = '';
                    decryptMessage.textContent = 'EntschlÃ¼sselung fehlgeschlagen. Ist der private SchlÃ¼ssel korrekt und der Chiffretext gÃ¼ltig?';
                    appendDevLog('EntschlÃ¼sselung fehlgeschlagen.');
                }
            } catch (error) {
                decryptedOutput.value = '';
                decryptMessage.textContent = `EntschlÃ¼sselungsfehler: ${error.message || error}.`;
                appendDevLog(`EntschlÃ¼sselungsfehler: ${error.message || error}`);
            }
            setTimeout(() => decryptMessage.textContent = '', 5000);
        }
        
        function getStoredKeys() {
            const keysJSON = localStorage.getItem(storedKeysLocalStorageKey);
            try { return keysJSON ? JSON.parse(keysJSON) : []; }
            catch (e) {
                appendDevLog("Fehler beim Parsen gespeicherter SchlÃ¼ssel. Setze auf leeres Array.");
                localStorage.removeItem(storedKeysLocalStorageKey); return [];
            }
        }

        function saveStoredKeys(keys) {
            localStorage.setItem(storedKeysLocalStorageKey, JSON.stringify(keys));
        }

        function renderStoredKeysInSidebar() {
            const keys = getStoredKeys();
            storedKeysListUI.innerHTML = '';
            if (keys.length === 0) {
                const li = document.createElement('li');
                li.className = 'px-4 py-3 text-sm text-center';
                li.style.color = 'var(--color-on-surface-variant)';
                li.textContent = 'Keine SchlÃ¼ssel hier.';
                storedKeysListUI.appendChild(li);
                return;
            }

            keys.forEach((keyObj, index) => {
                const containerLi = document.createElement('li');
                containerLi.className = 'stored-key-item-container';

                const mainDiv = document.createElement('div');
                mainDiv.className = 'stored-key-item-main group';
                mainDiv.title = `SchlÃ¼ssel "${keyObj.name}" auswÃ¤hlen/verwalten`;
                mainDiv.onclick = () => toggleKeyActions(index, keyObj.name);

                const iconSpan = document.createElement('span');
                iconSpan.className = 'material-icons';
                iconSpan.textContent = 'key';
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'key-name';
                nameSpan.textContent = keyObj.name;

                const expandIcon = document.createElement('span');
                expandIcon.className = 'material-icons transition-transform duration-200';
                expandIcon.textContent = 'expand_more';
                expandIcon.id = `expand_icon_${index}`;

                mainDiv.appendChild(iconSpan);
                mainDiv.appendChild(nameSpan);
                mainDiv.appendChild(expandIcon);
                containerLi.appendChild(mainDiv);

                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'stored-key-actions';
                actionsDiv.id = `actions_div_${index}`;
                
                actionsDiv.innerHTML = `
                    <button title="AuswÃ¤hlen" onclick="loadKeyFromStorage(${index}, event)"><span class="material-icons">check_circle_outline</span>WÃ¤hlen</button>
                    <button title="Umbenennen" onclick="renameStoredKey(${index}, event)"><span class="material-icons">edit</span></button>
                    <button title="Exportieren" onclick="exportStoredKeyPair(${index}, event)"><span class="material-icons">file_download</span></button>
                    <button title="LÃ¶schen" class="delete" onclick="deleteStoredKey(${index}, event)"><span class="material-icons">delete</span></button>
                `;
                containerLi.appendChild(actionsDiv);
                storedKeysListUI.appendChild(containerLi);
            });
        }
        
        function toggleKeyActions(index, keyName) {
            const actionsDiv = document.getElementById(`actions_div_${index}`);
            const expandIcon = document.getElementById(`expand_icon_${index}`);
            const mainDiv = actionsDiv.previousElementSibling; 
            const containerLi = actionsDiv.parentElement;

            const allActionDivs = document.querySelectorAll('.stored-key-actions');
            const allExpandIcons = document.querySelectorAll('.stored-key-item-main .material-icons:last-child');
            const allMainDivs = document.querySelectorAll('.stored-key-item-main');

            allActionDivs.forEach((div, i) => {
                if (i !== index && div.style.display === 'flex') {
                    div.style.display = 'none';
                    if (allExpandIcons[i]) allExpandIcons[i].style.transform = 'rotate(0deg)';
                    if (allMainDivs[i]) allMainDivs[i].classList.remove('active');
                    if (div.parentElement) div.parentElement.classList.remove('actions-visible');
                }
            });
            
            if (actionsDiv.style.display === 'flex') {
                actionsDiv.style.display = 'none';
                expandIcon.style.transform = 'rotate(0deg)';
                mainDiv.classList.remove('active');
                containerLi.classList.remove('actions-visible');
            } else {
                actionsDiv.style.display = 'flex';
                expandIcon.style.transform = 'rotate(180deg)';
                mainDiv.classList.add('active');
                containerLi.classList.add('actions-visible');
                appendDevLog(`Aktionen fÃ¼r SchlÃ¼ssel "${keyName}" angezeigt.`);
            }
        }

        function saveCurrentKeyPairToSidebar() {
            const pubKey = publicKeyOutput.value;
            const privKey = privateKeyOutput.value;

            if (!pubKey || !privKey) {
                keyMessage.textContent = 'Keine SchlÃ¼ssel zum Speichern. Generieren Sie zuerst ein Paar.';
                setTimeout(() => keyMessage.textContent = '', 4000); return;
            }

            let name = prompt("Geben Sie eine Bezeichnung fÃ¼r dieses SchlÃ¼sselpaar ein:", `Mein SchlÃ¼ssel ${new Date().toLocaleDateString('de-DE')}`);
            if (!name) { keyMessage.textContent = 'Speichern abgebrochen.'; setTimeout(() => keyMessage.textContent = '', 3000); return; }

            const keys = getStoredKeys();
            while (keys.some(k => k.name === name)) {
                name = prompt(`Der Name "${name}" existiert bereits. Bitte wÃ¤hlen Sie einen anderen Namen:`, `${name} (Kopie)`);
                if (!name) { keyMessage.textContent = 'Speichern abgebrochen.'; setTimeout(() => keyMessage.textContent = '', 3000); return; }
            }
            
            keys.push({ name, publicKey: pubKey, privateKey: privKey });
            saveStoredKeys(keys);
            renderStoredKeysInSidebar();
            keyMessage.textContent = `SchlÃ¼ssel "${name}" in Sidebar gespeichert.`;
            appendDevLog(`SchlÃ¼ssel "${name}" gespeichert.`);
            setTimeout(() => keyMessage.textContent = '', 4000);
        }
        
        function loadKeyFromStorage(index, event) {
            event.stopPropagation();
            const keys = getStoredKeys();
            if (index >= 0 && index < keys.length) {
                const keyObj = keys[index];
                publicKeyOutput.value = keyObj.publicKey;
                privateKeyOutput.value = keyObj.privateKey;
                publicKeyForEncryptInput.value = keyObj.publicKey;
                privateKeyForDecryptInput.value = keyObj.privateKey;
                keyMessage.textContent = `SchlÃ¼ssel "${keyObj.name}" geladen.`;
                appendDevLog(`SchlÃ¼ssel "${keyObj.name}" aus Speicher geladen.`);
                
                document.querySelectorAll('.stored-key-item-main').forEach(el => el.classList.remove('active'));
                const mainDiv = document.getElementById(`actions_div_${index}`).previousElementSibling;
                mainDiv.classList.add('active');
                
                const actionsDiv = document.getElementById(`actions_div_${index}`);
                const expandIcon = document.getElementById(`expand_icon_${index}`);
                if (actionsDiv && expandIcon) {
                    actionsDiv.style.display = 'none';
                    expandIcon.style.transform = 'rotate(0deg)';
                    if (actionsDiv.parentElement) actionsDiv.parentElement.classList.remove('actions-visible');
                }
                closeSidebarAfterAction();
                setTimeout(() => keyMessage.textContent = '', 4000);
            }
        }
        
        function renameStoredKey(index, event) {
            event.stopPropagation();
            const keys = getStoredKeys();
            if (index >= 0 && index < keys.length) {
                const oldName = keys[index].name;
                let newName = prompt(`Neuen Namen fÃ¼r SchlÃ¼ssel "${oldName}" eingeben:`, oldName);
                if (!newName || newName === oldName) { appendDevLog("Umbenennen abgebrochen oder Name nicht geÃ¤ndert."); return; }

                while (keys.some((k, i) => i !== index && k.name === newName)) {
                    newName = prompt(`Der Name "${newName}" existiert bereits. Bitte wÃ¤hlen Sie einen anderen Namen:`, `${newName} (1)`);
                    if (!newName) { appendDevLog("Umbenennen abgebrochen."); return; }
                }
                keys[index].name = newName;
                saveStoredKeys(keys);
                renderStoredKeysInSidebar();
                keyMessage.textContent = `SchlÃ¼ssel von "${oldName}" zu "${newName}" umbenannt.`;
                appendDevLog(`SchlÃ¼ssel umbenannt: ${oldName} -> ${newName}`);
                setTimeout(() => keyMessage.textContent = '', 4000);
            }
        }

        function deleteStoredKey(index, event) {
            event.stopPropagation();
            const keys = getStoredKeys();
            if (index >= 0 && index < keys.length) {
                const keyNameToDelete = keys[index].name;
                if (confirm(`MÃ¶chten Sie den SchlÃ¼ssel "${keyNameToDelete}" wirklich lÃ¶schen?`)) {
                    keys.splice(index, 1);
                    saveStoredKeys(keys);
                    renderStoredKeysInSidebar();
                    keyMessage.textContent = `SchlÃ¼ssel "${keyNameToDelete}" gelÃ¶scht.`;
                    appendDevLog(`SchlÃ¼ssel "${keyNameToDelete}" gelÃ¶scht.`);
                    setTimeout(() => keyMessage.textContent = '', 4000);
                }
            }
        }

        function copyToClipboard(elementId, type) {
            const textarea = document.getElementById(elementId);
            if (!textarea.value) { alert(`${type} ist leer, nichts zu kopieren.`); return; }
            textarea.select();
            textarea.setSelectionRange(0, 99999); 
            try {
                document.execCommand('copy');
                const messageEl = type.includes('Ã–ffentlicher') || type.includes('Privater') ? keyMessage : (type.includes('VerschlÃ¼sselter') ? encryptMessage : decryptMessage);
                if (messageEl) { messageEl.textContent = `${type} in Zwischenablage kopiert!`; setTimeout(() => messageEl.textContent = '', 3000); }
                appendDevLog(`${type} in Zwischenablage kopiert.`);
            } catch (err) { alert('Kopieren fehlgeschlagen.'); appendDevLog(`Fehler beim Kopieren: ${err}`); }
            window.getSelection()?.removeAllRanges();
        }
        
        function scrollToElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) { element.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
        }

        function toggleSidebar() {
            const isOpen = sidebar.classList.toggle('open');
            contentOverlay.classList.toggle('active', isOpen);
            document.body.classList.toggle('sidebar-open', isOpen);
            sidebarToggle.setAttribute('aria-expanded', isOpen);
            sidebarToggle.classList.toggle('hidden-when-sidebar-open', isOpen);
        }

        function closeSidebarAfterAction(shouldScrollToTop = true) {
            if (sidebar.classList.contains('open') && window.innerWidth <= 992) { toggleSidebar(); }
        }

        sidebarToggle.addEventListener('click', toggleSidebar);
        sidebarInternalToggle.addEventListener('click', toggleSidebar);
        contentOverlay.addEventListener('click', toggleSidebar);

        generateKeysButton.addEventListener('click', generateRSAKeyPair);
        saveCurrentKeysButton.addEventListener('click', saveCurrentKeyPairToSidebar);
        encryptButton.addEventListener('click', encryptRSA);
        decryptButton.addEventListener('click', decryptRSA);

        function applyThemeColors(primary, secondary) {
            document.documentElement.style.setProperty('--color-primary', primary);
            document.documentElement.style.setProperty('--color-secondary', secondary);
            const primaryVariant = pSBC(-0.4, primary);
            document.documentElement.style.setProperty('--color-primary-variant', primaryVariant || primary);
            primaryColorInput.value = primary;
            secondaryColorInput.value = secondary;
        }
        
        const pSBC=(p,c0,c1,l)=>{
            let r,g,b,P,f,t,h,i=parseInt,m=Math.round,a=typeof(c1)=="string";
            if(typeof(p)!="number"||p<-1||p>1||typeof(c0)!="string"||(c0[0]!='r'&&c0[0]!='#')||(c1&&!a))return null;
            if(!this.pSBCr)this.pSBCr=(d)=>{
                let n=d.length,x={};
                if(n>9){
                    [r,g,b,a]=d=d.split(","),n=d.length;
                    if(n<3||n>4)return null;
                    x.r=i(r[3]=="a"?r.slice(5):r.slice(4)),x.g=i(g),x.b=i(b),x.a=a?parseFloat(a):-1
                }else{
                    if(n==8||n==6||n<4)return null;
                    if(n<6)d="#"+d[1]+d[1]+d[2]+d[2]+d[3]+d[3]+(n>4?d[4]+d[4]:"");
                    d=i(d.slice(1),16);
                    if(n==9||n==5)x.r=d>>24&255,x.g=d>>16&255,x.b=d>>8&255,x.a=m((d&255)/0.255)/1000;
                    else x.r=d>>16,x.g=d>>8&255,x.b=d&255,x.a=-1
                }return x};
            h=c0.length>9,h=a?c1.length>9?true:c1=="c"?!h:false:h,f=this.pSBCr(c0),P=p<0,t=c1&&c1!="c"?this.pSBCr(c1):P?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},p=P?p*-1:p,P=1-p;
            if(!f||!t)return null;
            if(l)r=m(P*f.r+p*t.r),g=m(P*f.g+p*t.g),b=m(P*f.b+p*t.b);
            else r=m((P*f.r**2+p*t.r**2)**0.5),g=m((P*f.g**2+p*t.g**2)**0.5),b=m((P*f.b**2+p*t.b**2)**0.5);
            a=f.a,t=t.a,f=a>=0||t>=0,a=f?a<0?t:t<0?a:a*P+t*p:0;
            if(h)return"rgb"+(f?"a(":"(")+r+","+g+","+b+(f?","+m(a*1000)/1000:"")+")";
            else return"#"+(4294967296+r*16777216+g*65536+b*256+(f?m(a*255):0)).toString(16).slice(1,f?undefined:-2)
        }

        function saveTheme() {
            const primary = primaryColorInput.value;
            const secondary = secondaryColorInput.value;
            applyThemeColors(primary, secondary);
            localStorage.setItem(themeLocalStorageKey, JSON.stringify({ primary, secondary }));
            closeModal('themePopup');
            appendDevLog(`Theme gespeichert: PrimÃ¤r ${primary}, SekundÃ¤r ${secondary}`);
        }

        function loadSavedTheme() {
            const theme = localStorage.getItem(themeLocalStorageKey);
            let defaultPrimary = getComputedStyle(document.documentElement).getPropertyValue('--color-primary').trim();
            let defaultSecondary = getComputedStyle(document.documentElement).getPropertyValue('--color-secondary').trim();

            if (theme) {
                try { const { primary, secondary } = JSON.parse(theme); applyThemeColors(primary, secondary); appendDevLog('Gespeichertes Theme geladen.'); }
                catch (e) { localStorage.removeItem(themeLocalStorageKey); applyThemeColors(defaultPrimary, defaultSecondary); appendDevLog('Fehler beim Laden, Standardtheme angewendet.'); }
            } else { applyThemeColors(defaultPrimary, defaultSecondary); appendDevLog('Kein gespeichertes Theme, Standard CSS Variablen verwendet.'); }
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute("data-theme");
            const newTheme = currentTheme === "light" ? "dark" : "light";
            document.documentElement.setAttribute("data-theme", newTheme);
            localStorage.setItem(themePreferenceLocalStorageKey, newTheme);
            appendDevLog(`Theme geÃ¤ndert zu ${newTheme}.`);
            loadSavedTheme();
        }

        function loadThemePreference() {
            const preferredTheme = localStorage.getItem(themePreferenceLocalStorageKey);
            document.documentElement.setAttribute("data-theme", preferredTheme || "light");
            loadSavedTheme();
        }
        
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                if (modalId === 'version-info-modal') closeModal('themePopup');
                if (modalId === 'themePopup') closeModal('version-info-modal');
            }
        }
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.add('hidden');
        }

        function showThemePopup() { openModal('themePopup'); }

        const changelogHTML = `
            <ul class="list-disc list-inside space-y-2 text-sm" style="color: var(--color-on-surface-variant);">
                <li>MIGRATION DER APP ZU https://quixoticode.github.io/apps/ (LETZTE INFO FOLGT!)</li>
            </ul>
        `;

        function showCurrentChangelog() {
            if(currentVersionModalSpan) currentVersionModalSpan.textContent = currentAppVersion;
            if(changelogContentEl) changelogContentEl.innerHTML = changelogHTML;
            openModal('version-info-modal');
            appendDevLog('Changelog angezeigt.');
        }

        closeChangelogButton.addEventListener('click', () => {
            closeModal('version-info-modal');
            localStorage.setItem(lastSeenVersionKey, currentAppVersion);
            appendDevLog('Changelog geschlossen, Version als gesehen markiert.');
        });
        
        function exportDataToFile(dataObject, baseFilename) {
            const blob = new Blob([JSON.stringify(dataObject, null, 2)], { type: "application/json" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `${baseFilename}_${new Date().toISOString().slice(0,10).replace(/-/g,'')}.qsnd`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            URL.revokeObjectURL(a.href);
        }

        function exportTextData() {
            let dataToExport = encryptedOutput.value.trim();
            if (!dataToExport) dataToExport = textToEncryptInput.value.trim();
            if (!dataToExport) { alert("Nichts zu exportieren."); return; }

            const data = {
                timestamp: new Date().toISOString(), version: currentAppVersion, dataType: "text",
                content: dataToExport,
                note: "QSounds Text Export."
            };
            exportDataToFile(data, "qsounds_text_export");
            appendDevLog('Textdaten exportiert.');
        }
        
        function exportKeyPairData(name, publicKey, privateKey, sourceNote) {
            if (!publicKey || !privateKey) { alert("Kein vollstÃ¤ndiges SchlÃ¼sselpaar zum Exportieren vorhanden."); return; }
            const data = {
                timestamp: new Date().toISOString(), version: currentAppVersion, dataType: "keyPair",
                keyName: name || "Unbenanntes SchlÃ¼sselpaar", publicKey, privateKey,
                note: sourceNote || "QSounds SchlÃ¼sselpaar Export."
            };
            exportDataToFile(data, `qsounds_keypair_${(name || "export").replace(/\s+/g, '_')}`);
            appendDevLog(`SchlÃ¼sselpaar "${name}" exportiert.`);
        }
        
        function exportCurrentKeyPairData() {
            const pubKey = publicKeyOutput.value;
            const privKey = privateKeyOutput.value;
            exportKeyPairData("Aktuell angezeigt", pubKey, privKey, "Export des aktuell in der App angezeigten SchlÃ¼sselpaars.");
        }

        function exportStoredKeyPair(index, event) {
            event.stopPropagation();
            const keys = getStoredKeys();
            if (index >= 0 && index < keys.length) {
                const keyObj = keys[index];
                exportKeyPairData(keyObj.name, keyObj.publicKey, keyObj.privateKey, `Export des gespeicherten SchlÃ¼sselpaars "${keyObj.name}".`);
            }
        }

        function importKeyPairFile() {
            const input = document.createElement("input");
            input.type = "file";
            input.accept = ".qsnd,.json";

            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const fileText = await file.text();
                try {
                    const data = JSON.parse(fileText);
                    if (data.dataType === "keyPair" && data.publicKey && data.privateKey) {
                        let keyName = data.keyName || `Importiert ${new Date().toLocaleTimeString('de-DE')}`;
                        const keys = getStoredKeys();
                        while (keys.some(k => k.name === keyName)) {
                            keyName = prompt(`Ein SchlÃ¼ssel mit dem Namen "${keyName}" existiert bereits. Bitte neuen Namen vergeben:`, `${keyName} (Import)`);
                            if (!keyName) { alert("Import abgebrochen."); return; }
                        }
                        keys.push({ name: keyName, publicKey: data.publicKey, privateKey: data.privateKey });
                        saveStoredKeys(keys);
                        renderStoredKeysInSidebar();
                        alert(`SchlÃ¼sselpaar "${keyName}" erfolgreich importiert und in der Sidebar gespeichert.`);
                        appendDevLog(`SchlÃ¼sselpaar "${keyName}" importiert.`);
                    } else if (data.dataType === "text" && data.content) {
                         if (data.content.length > 200 && (data.content.includes('='))) { 
                           textToDecryptInput.value = data.content;
                           alert("Textdatei importiert. Inhalt wurde in das Feld 'Zu entschlÃ¼sselnder Chiffretext' eingefÃ¼gt, da es wie verschlÃ¼sselter Text aussieht.");
                        } else {
                           textToEncryptInput.value = data.content;
                           alert("Textdatei importiert. Inhalt wurde in das Feld 'Zu verschlÃ¼sselnder Text' eingefÃ¼gt.");
                        }
                        appendDevLog('Textdatei importiert.');
                    }
                    else { alert("UngÃ¼ltige .qsnd Datei oder falscher dataType."); appendDevLog('UngÃ¼ltige Importdatei.'); }
                } catch (err) {
                    alert("Fehler beim Lesen der Datei.");
                    appendDevLog(`Fehler beim Import: ${err.message || err}`);
                }
            };
            input.click();
        }
        
        function appendDevLog(message) {
            if (devLog) {
                const timestamp = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit', second: '2-digit'});
                devLog.innerHTML += `[${timestamp}] ${message}\n`;
                devLog.scrollTop = devLog.scrollHeight;
            }
        }

        function showDevPortal() {
            const portal = document.getElementById('devPortal');
            portal.style.display = 'block';
            appendDevLog('Entwicklerportal geÃ¶ffnet.');
            closeModal('version-info-modal'); closeModal('themePopup');
        }

        document.addEventListener('DOMContentLoaded', () => {
            if(displayedVersionSpan) displayedVersionSpan.textContent = currentAppVersion;
            loadThemePreference();
            renderStoredKeysInSidebar();

            const lastSeenVersion = localStorage.getItem(lastSeenVersionKey);
            if (lastSeenVersion !== currentAppVersion) { showCurrentChangelog(); }
            else { appendDevLog(`Aktuelle Version ${currentAppVersion} bereits gesehen.`); }
            
            if (!publicKeyOutput.value || !privateKeyOutput.value) {
                 keyMessage.textContent = 'Generieren Sie ein SchlÃ¼sselpaar oder laden/importieren Sie eines.';
            }
            appendDevLog(`QSounds v${currentAppVersion} Initialisiert.`);
        });

        window.addEventListener("keydown", (e) => {
            if (e.ctrlKey && e.shiftKey && (e.key === "D" || e.key === "d")) { e.preventDefault(); showDevPortal(); }
            if (e.key === "Escape") {
                closeModal('version-info-modal'); closeModal('themePopup');
                if (document.getElementById('devPortal').style.display === 'block') {
                    document.getElementById('devPortal').style.display = 'none';
                }
            }
        });

    </script>
</body>
</html>

